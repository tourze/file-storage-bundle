<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Trix å›¾ç‰‡é€‰æ‹©å™¨æµ‹è¯•é¡µé¢</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Trix CSS -->
    <link href="https://unpkg.com/trix@2.0.0/dist/trix.css" rel="stylesheet" type="text/css">
    
    <!-- æˆ‘ä»¬çš„å›¾ç‰‡é€‰æ‹©å™¨æ ·å¼ -->
    <link href="src/Resources/public/css/trix-image-picker.css" rel="stylesheet" type="text/css">
    
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        trix-editor {
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ğŸ–¼ï¸ Trix å›¾ç‰‡é€‰æ‹©å™¨æµ‹è¯•é¡µé¢</h1>
        
        <div class="alert alert-info">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong> 
            <ul class="mb-0">
                <li>åœ¨ä¸‹é¢çš„ Trix ç¼–è¾‘å™¨ä¸­æŸ¥æ‰¾å›¾ç‰‡é€‰æ‹©æŒ‰é’®ï¼ˆğŸ“·ï¼‰</li>
                <li>ç‚¹å‡»æŒ‰é’®åº”è¯¥æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨ Modal</li>
                <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>åŸºæœ¬ Trix ç¼–è¾‘å™¨æµ‹è¯•</h3>
            <div class="mb-3">
                <label class="form-label" for="content">æ–‡ç« å†…å®¹</label>
                <input id="content" name="content" type="hidden">
                <trix-editor input="content" placeholder="åœ¨è¿™é‡Œè¾“å…¥å†…å®¹..."></trix-editor>
            </div>
        </div>

        <div class="test-section">
            <h3>å¸¦è‡ªå®šä¹‰é…ç½®çš„ Trix ç¼–è¾‘å™¨</h3>
            <div class="mb-3">
                <label class="form-label" for="content2">æè¿°å†…å®¹</label>
                <input id="content2" name="content2" type="hidden">
                <trix-editor input="content2" placeholder="è¿™æ˜¯å¦ä¸€ä¸ªç¼–è¾‘å™¨..."></trix-editor>
            </div>
        </div>

        <div class="debug-info">
            <h5>è°ƒè¯•ä¿¡æ¯:</h5>
            <div id="debug-output">
                ç­‰å¾… JavaScript åˆå§‹åŒ–...
            </div>
        </div>

        <div class="mt-4">
            <button class="btn btn-primary" onclick="testImagePicker()" type="button">
                æµ‹è¯•å›¾ç‰‡é€‰æ‹©å™¨åŠŸèƒ½
            </button>
            <button class="btn btn-secondary" onclick="clearDebug()" type="button">
                æ¸…ç©ºè°ƒè¯•ä¿¡æ¯
            </button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Trix JS -->
    <script src="https://unpkg.com/trix@2.0.0/dist/trix.umd.min.js" type="text/javascript"></script>
    
    <!-- æˆ‘ä»¬çš„å›¾ç‰‡é€‰æ‹©å™¨è„šæœ¬ -->
    <script src="src/Resources/public/js/trix-image-picker.js" type="text/javascript"></script>
    
    <script>
        // è°ƒè¯•å·¥å…·
        const debugOutput = document.getElementById('debug-output');
        
        function logDebug(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }
        
        function clearDebug() {
            debugOutput.innerHTML = 'è°ƒè¯•ä¿¡æ¯å·²æ¸…ç©º';
        }
        
        function testImagePicker() {
            logDebug('ğŸ§ª å¼€å§‹æµ‹è¯•å›¾ç‰‡é€‰æ‹©å™¨åŠŸèƒ½');
            
            // æ£€æŸ¥ Trix ç¼–è¾‘å™¨
            const editors = document.querySelectorAll('trix-editor');
            logDebug(`âœ… æ‰¾åˆ° ${editors.length} ä¸ª Trix ç¼–è¾‘å™¨`);
            
            // æ£€æŸ¥å›¾ç‰‡é€‰æ‹©å™¨æŒ‰é’®
            const buttons = document.querySelectorAll('[data-trix-action="x-image-gallery"]');
            logDebug(`âœ… æ‰¾åˆ° ${buttons.length} ä¸ªå›¾ç‰‡é€‰æ‹©å™¨æŒ‰é’®`);
            
            if (buttons.length === 0) {
                logDebug('âŒ æœªæ‰¾åˆ°å›¾ç‰‡é€‰æ‹©å™¨æŒ‰é’®ï¼Œè¯·æ£€æŸ¥ JavaScript æ˜¯å¦æ­£ç¡®åŠ è½½');
            } else {
                logDebug('âœ… å›¾ç‰‡é€‰æ‹©å™¨æŒ‰é’®å·²æ­£ç¡®æ·»åŠ åˆ°å·¥å…·æ ');
                
                // å°è¯•ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰é’®
                if (buttons[0]) {
                    logDebug('ğŸ–±ï¸ æ¨¡æ‹Ÿç‚¹å‡»ç¬¬ä¸€ä¸ªå›¾ç‰‡é€‰æ‹©å™¨æŒ‰é’®');
                    buttons[0].click();
                }
            }
        }
        
        // ç›‘å¬ Trix äº‹ä»¶
        document.addEventListener('trix-initialize', function(e) {
            logDebug(`ğŸ“ Trix ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ: ${e.target.id || 'unnamed'}`);
        });
        
        document.addEventListener('trix-change', function(e) {
            logDebug(`ğŸ“ Trix ç¼–è¾‘å™¨å†…å®¹å˜åŒ–: ${e.target.id || 'unnamed'}`);
        });
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('ğŸ“„ é¡µé¢ DOM åŠ è½½å®Œæˆ');
            
            setTimeout(() => {
                testImagePicker();
            }, 1000);
        });
        
        // é‡å†™ console.log ä»¥åœ¨é¡µé¢æ˜¾ç¤º
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDebug('ğŸ”§ ' + args.join(' '));
        };
        
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            logDebug('âŒ ERROR: ' + args.join(' '));
        };
        
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logDebug('âš ï¸ WARNING: ' + args.join(' '));
        };
    </script>
</body>
</html>