<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Trix 图片选择器测试页面</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Trix CSS -->
    <link href="https://unpkg.com/trix@2.0.0/dist/trix.css" rel="stylesheet" type="text/css">
    
    <!-- 我们的图片选择器样式 -->
    <link href="src/Resources/public/css/trix-image-picker.css" rel="stylesheet" type="text/css">
    
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
        trix-editor {
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">🖼️ Trix 图片选择器测试页面</h1>
        
        <div class="alert alert-info">
            <strong>测试说明：</strong> 
            <ul class="mb-0">
                <li>在下面的 Trix 编辑器中查找图片选择按钮（📷）</li>
                <li>点击按钮应该打开图片选择器 Modal</li>
                <li>打开浏览器开发者工具查看控制台调试信息</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>基本 Trix 编辑器测试</h3>
            <div class="mb-3">
                <label class="form-label" for="content">文章内容</label>
                <input id="content" name="content" type="hidden">
                <trix-editor input="content" placeholder="在这里输入内容..."></trix-editor>
            </div>
        </div>

        <div class="test-section">
            <h3>带自定义配置的 Trix 编辑器</h3>
            <div class="mb-3">
                <label class="form-label" for="content2">描述内容</label>
                <input id="content2" name="content2" type="hidden">
                <trix-editor input="content2" placeholder="这是另一个编辑器..."></trix-editor>
            </div>
        </div>

        <div class="debug-info">
            <h5>调试信息:</h5>
            <div id="debug-output">
                等待 JavaScript 初始化...
            </div>
        </div>

        <div class="mt-4">
            <button class="btn btn-primary" onclick="testImagePicker()" type="button">
                测试图片选择器功能
            </button>
            <button class="btn btn-secondary" onclick="clearDebug()" type="button">
                清空调试信息
            </button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Trix JS -->
    <script src="https://unpkg.com/trix@2.0.0/dist/trix.umd.min.js" type="text/javascript"></script>
    
    <!-- 我们的图片选择器脚本 -->
    <script src="src/Resources/public/js/trix-image-picker.js" type="text/javascript"></script>
    
    <script>
        // 调试工具
        const debugOutput = document.getElementById('debug-output');
        
        function logDebug(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }
        
        function clearDebug() {
            debugOutput.innerHTML = '调试信息已清空';
        }
        
        function testImagePicker() {
            logDebug('🧪 开始测试图片选择器功能');
            
            // 检查 Trix 编辑器
            const editors = document.querySelectorAll('trix-editor');
            logDebug(`✅ 找到 ${editors.length} 个 Trix 编辑器`);
            
            // 检查图片选择器按钮
            const buttons = document.querySelectorAll('[data-trix-action="x-image-gallery"]');
            logDebug(`✅ 找到 ${buttons.length} 个图片选择器按钮`);
            
            if (buttons.length === 0) {
                logDebug('❌ 未找到图片选择器按钮，请检查 JavaScript 是否正确加载');
            } else {
                logDebug('✅ 图片选择器按钮已正确添加到工具栏');
                
                // 尝试点击第一个按钮
                if (buttons[0]) {
                    logDebug('🖱️ 模拟点击第一个图片选择器按钮');
                    buttons[0].click();
                }
            }
        }
        
        // 监听 Trix 事件
        document.addEventListener('trix-initialize', function(e) {
            logDebug(`📝 Trix 编辑器初始化完成: ${e.target.id || 'unnamed'}`);
        });
        
        document.addEventListener('trix-change', function(e) {
            logDebug(`📝 Trix 编辑器内容变化: ${e.target.id || 'unnamed'}`);
        });
        
        // 页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('📄 页面 DOM 加载完成');
            
            setTimeout(() => {
                testImagePicker();
            }, 1000);
        });
        
        // 重写 console.log 以在页面显示
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDebug('🔧 ' + args.join(' '));
        };
        
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            logDebug('❌ ERROR: ' + args.join(' '));
        };
        
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logDebug('⚠️ WARNING: ' + args.join(' '));
        };
    </script>
</body>
</html>